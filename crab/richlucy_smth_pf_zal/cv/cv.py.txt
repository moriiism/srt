#
# cv.py.txt
#

source ~/work/github/moriiism/mitool/setup/setup_arb01.sh

cd /home/morii/work/arb/ana/run/crab/hxt1/rl_smth_pf_zal

# response format
nskyx=101
nskyy=101
ndetx=80
ndety=80

# data_list
cat << EOF > data.list
# data_file  phase_tag  phase_ratio  flux_0
# /home/ymaeda/work/share/hxt/barycen_3rd/hxt1_phase_00_151_300_x1178y1175_w80.fits  all  1.0   ***
/home/ymaeda/work/share/hxt/barycen_3rd/hxt1_phase_21_151_300_x1178y1175_w80.fits  on2   0.25  389.0
/home/ymaeda/work/share/hxt/barycen_3rd/hxt1_phase_22_151_300_x1178y1175_w80.fits  off1  0.40  0.0
/home/ymaeda/work/share/hxt/barycen_3rd/hxt1_phase_23_151_300_x1178y1175_w80.fits  on1   0.20  113.0
/home/ymaeda/work/share/hxt/barycen_3rd/hxt1_phase_24_151_300_x1178y1175_w80.fits  off2  0.15  96.0
EOF

# mu, gamma list
~/work/github/moriiism/srt/script/logbin.py \
1e-7 1e0 7

cat << EOF > cv/mu.list
1.0000e-07
1.0000e-06
1.0000e-05
1.0000e-04
1.0000e-03
1.0000e-02
1.0000e-01
1.0000e+00
EOF

cat << EOF > cv/gamma.list
1.0000e-07
1.0000e-06
1.0000e-05
1.0000e-04
1.0000e-03
1.0000e-02
1.0000e-01
1.0000e+00
EOF

data_list=data.list
bg_file=none
rand_seed=1
nfold=5
nskyx=$nskyx
nskyy=$nskyy
ndetx=$ndetx
ndety=$ndety
resp_dir=/home/ymaeda/work/share/hxt/barycen_3rd/hxt1/151_300/gimage_100
posx_point_src=54
posy_point_src=41
outdir=cv
outfile_head=hxt1_crab_4phase
nem=10000
tol_em=1.0e-7
mu_list=cv/mu.list
gamma_list=cv/gamma.list
acc_method=none


~/work/github/moriiism/srt/crab/richlucy_smth_pf_zal/cv/cv.py \
$data_list \
$bg_file \
$rand_seed \
$nfold \
$nskyx \
$nskyy \
$ndetx \
$ndety \
$resp_dir \
$posx_point_src \
$posy_point_src \
$outdir \
$outfile_head \
$nem \
$tol_em \
$mu_list \
$gamma_list \
$acc_method


~/work/github/moriiism/srt/crab/richlucy_smth_pf_zal/cv/cv_smr.py \
$data_list \
$rand_seed \
$nfold \
$outdir \
$outfile_head \
$mu_list \
$gamma_list




/home/morii/work/github/moriiism/srt/crab/richlucy_smth_pf_zal/eval_val \
cv/resp/hxt1_resp_norm.fits \
cv/rec/mu1.0e-07/gamma1.0e-07/nfold05/ifold01/rec_rec_00.fits \
cv/obs_cv/on2/hxt1_crab_4phase_obs_0001_05fold01_vl.fits \
5 cv/rec/mu1.0e-07/gamma1.0e-07/nfold05/ifold01 eval




