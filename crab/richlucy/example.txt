#
# example.txt
#

# 1. mkresp
# 3. richlucy

# data
../../hitomi/hxt/gimage_hxt1/crab_hxi1_gti_off1_rate_x1175y1185_w80.fits
../../hitomi/hxt/gimage_hxt1/crab_hxi1_gti_off2_rate_x1175y1185_w80.fits
../../hitomi/hxt/gimage_hxt1/crab_hxi1_gti_on1_rate_x1175y1185_w80.fits
../../hitomi/hxt/gimage_hxt1/crab_hxi1_gti_on2_rate_x1175y1185_w80.fits

source ~/work/github/moriiism/mitool/setup/setup_jaxa.sh 

cd /home/morii/work/arb/ana/run/crab/hxt1/rl

# response format
nskyx=101
nskyy=101
ndetx=80
ndety=80

# 1. make response matrix, normed response matrix, 
#    and efficiency matrix files

respdir=/home/morii/work/arb/hitomi/hxt/gimage_hxt1/gimage_100
outdir=resp
outfile_head=arb
nskyx=$nskyx
nskyy=$nskyy
nphoton_input=100

/home/morii/work/github/moriiism/srt/mkresp/mkresp \
$respdir \
$outdir \
$outfile_head \
$nskyx \
$nskyy \
$nphoton_input

--->
  resp/arb_eff.fits        : efficiency file
  resp/arb_resp.fits       : response file
  resp/arb_resp_norm.fits  : normalized response file


# 2. richlucy

cat << EOF > data.list
# data_file phase_tag
../../../../../hitomi/hxt/gimage_hxt1/crab_hxi1_gti_off1_rate_x1175y1185_w80.fits  off1
../../../../../hitomi/hxt/gimage_hxt1/crab_hxi1_gti_off2_rate_x1175y1185_w80.fits  off2
../../../../../hitomi/hxt/gimage_hxt1/crab_hxi1_gti_on1_rate_x1175y1185_w80.fits   on1
../../../../../hitomi/hxt/gimage_hxt1/crab_hxi1_gti_on2_rate_x1175y1185_w80.fits   on2
EOF

data_list=data.list
resp_file=resp/arb_resp.fits
eff_file=resp/arb_eff.fits
nskyx=$nskyx
nskyy=$nskyy
ndetx=$ndetx
ndety=$ndety
outdir=rl
outfile_head=hxt1_crab
nloop=1000
tol=1.0e-5
acc_method=squarem

~/work/github/moriiism/srt/crab/richlucy/richlucy \
$data_list \
$resp_file \
$eff_file \
$nskyx \
$nskyy \
$ndetx \
$ndety \
$outdir \
$outfile_head \
$nloop \
$tol \
$acc_method
